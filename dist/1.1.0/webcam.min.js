"use strict";!function(){navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.hasUserMedia=function(){return navigator.getMedia?!0:!1}}(),angular.module("webcam",[]).directive("webcam",function(){return{template:'<div class="webcam" style="border: 5px #f00 solid;" ng-transclude></div>',restrict:"E",replace:!0,transclude:!0,scope:{onError:"&",onStream:"&",onStreaming:"&",placeholder:"=",videoHeight:"=",videoWidth:"="},link:function(a,b){var c,d,e=function(){d&&"function"==typeof d.stop&&d.stop(),c&&delete c.src},f=function(b){if(d=b,navigator.mozGetUserMedia)c.mozSrcObject=b;else{var e=window.URL||window.webkitURL;c.src=e.createObjectURL(b)}c.play(),a.onStream&&a.onStream({stream:b,video:c})},g=function(b){removeLoader(),console&&console.log&&console.log("The following error occured: ",b),a.onError&&a.onError({err:b})},h=function(){if(c=document.createElement("video"),c.setAttribute("class","webcam-live"),c.setAttribute("autoplay",""),b.append(c),a.placeholder){var d=document.createElement("img");d.setAttribute("class","webcam-loader"),d.src=a.placeholder,b.append(d)}var e=function(){d&&angular.element(d).remove()},h=!1,i=b.width=a.videoWidth||320,j=b.height=0;if(!window.hasUserMedia())return void g({code:-1,msg:"Browser does not support getUserMedia."});var k={video:!0,audio:!1};navigator.getMedia(k,f,g),c.addEventListener("canplay",function(){if(!h){var b=i/c.videoWidth;j=c.videoHeight*b||a.videoHeight,c.setAttribute("width",i),c.setAttribute("height",j),h=!0,e(),a.onStreaming&&a.onStreaming({video:c})}},!1)},i=function(){e(),c.remove()};a.$on("$destroy",e),a.$on("START_WEBCAM",h),a.$on("STOP_WEBCAM",i),h()}}});