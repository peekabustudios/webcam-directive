"use strict";!function(){navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.hasUserMedia=function(){return navigator.getMedia?!0:!1}}(),angular.module("webcam",[]).directive("webcam",function(){return{template:'<div class="webcam" ng-transclude></div>',restrict:"E",replace:!0,transclude:!0,scope:{onError:"&",onStream:"&",onStreaming:"&",placeholder:"=",videoHeight:"=",videoWidth:"="},link:function(a,b){var c,d,e,f=-1,g=-1,h=function(){d&&"function"==typeof d.stop&&d.stop(),c&&delete c.src},i=function(b){if(d=b,navigator.mozGetUserMedia)c.mozSrcObject=b;else{var e=window.URL||window.webkitURL;c.src=e.createObjectURL(b)}c.play(),a.onStream&&a.onStream({stream:b,video:c})},j=function(b){removeLoader(),console&&console.log&&console.log("The following error occured: ",b),a.onError&&a.onError({err:b})},k=function(a){a="undefined"!=typeof a?a:0,"front"==a?a=f:"back"==a&&(a=g),(0>a||a>e.length-1)&&(a=0);var b={};console.log("cameras : ",e,"using id : ",a),-1==a&&(a=0),navigator.getUserMedia?b={video:{optional:[{sourceId:e[a].id}]}}:navigator.oGetUserMedia?ncamera_spec={video:{optional:[{sourceId:e[a].id}]}}:navigator.mozGetUserMedia?b={video:{optional:[{sourceId:e[a].id}]}}:navigator.webkitGetUserMedia?b={video:{optional:[{sourceId:e[a].id}]}}:navigator.msGetUserMedia&&(b={video:{optional:[{sourceId:e[a].id}]},audio:!1}),console.log("camera spec",b),m(b)},l=function(){if(c=document.createElement("video"),c.setAttribute("class","webcam-live"),c.setAttribute("autoplay",""),b.append(c),a.placeholder){var d=document.createElement("img");d.setAttribute("class","webcam-loader"),d.src=a.placeholder,b.append(d)}{var h=function(a){function b(a){e=[];for(var b=0;b<a.length;b++)"audio"!==a[b].kind&&(alert(a[b].facing),"user"==a[b].facing?f=b:"environment"==a[b].facing&&(g=b),e.push(a[b]))}var c="";navigator.webkitGetUserMedia&&(c=parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10)),navigator.mozGetUserMedia&&(c=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)),c>=30&&MediaStreamTrack.getSources(b),a()};b.width=a.videoWidth||320,b.height=0}return window.hasUserMedia()?(h(),void k(0)):void j({code:-1,msg:"Browser does not support getUserMedia."})},m=function(b){navigator.getMedia(b,i,j),c.addEventListener("canplay",function(){if(!isStreaming){var b=width/c.videoWidth;height=c.videoHeight*b||a.videoHeight,c.setAttribute("width",width),c.setAttribute("height",height),isStreaming=!0,removeLoader(),a.onStreaming&&a.onStreaming({video:c})}},!1)},n=function(){h(),c.remove()};a.$on("$destroy",h),a.$on("START_WEBCAM",l),a.$on("STOP_WEBCAM",n),l()}}});